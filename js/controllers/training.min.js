angular.module("trainSite",["pdate","timeago","jqDialog","ngCookies","jqAutoComplete","jqButton"]);var TrainCtrl=function(b,g,c,f){function d(){console.log("Adding Comment "+b.curCmt.msg+" from "+b.curCmt.usr);g.post("/res/trainings/"+tid+"/comments",b.curCmt).error(function(h){console.log("Fehler: "+h)}).success(function(h){console.log("OK!");b.comments.unshift(h)})}function e(){if(!b.nameKnown()){return false}myVote=$.grep(b.votes,function(h){return h.name==c.user});if(myVote.length>0){console.dir(myVote[0]);b.curVote=myVote[0];return true}else{return false}}b.nameKnown=function(){return !(b.usrname==""||!b.usrname)};b.revote=function(){console.log("revoting to "+b.curVote.vid);console.log("Usr is |"+b.curVote.name+"| -> empty:"+(b.curVote.name==""||!b.curVote.name));if(!b.curVote.name||b.curVote.name==""){f.alert("Bitte erst Namen eingeben!")}else{b.usrname=b.curVote.name;g.post("/res/trainings/"+tid+"/votes",b.curVote).error(function(h){console.log("Fehler: "+h)}).success(function(h){console.log("OK!");a()})}};function a(){nocache=Math.random();g.get("/res/trainings/"+tid+"/votes?nocache="+nocache).success(function(h){b.votes=h;b.voted=e()})}$.ajaxSetup({cache:false});b.usrname=c.user||"";b.curVote={tid:tid,name:c.user,vid:0,vote:""};b.curCmt={msg:"",autor:c.user,tid:tid};g.get("/res/votetypes").success(function(h){b.votetypes=h});g.get("/res/trainings/"+tid+"/comments").success(function(h){b.comments=h});g.get("/res/trainings/"+tid+"/stats").success(function(h){b.stats=h});g.get("/res/users").success(function(h){b.unames=h});g.get("/res/trainings/"+tid+"/details").success(function(h){b.details=h});a();b.dlgState=false;b.submitDlg=function(){d();b.dlgState=false}};TrainCtrl.$inject=["$scope","$http","$cookies","$window"];