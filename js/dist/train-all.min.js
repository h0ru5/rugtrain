/*! RugTrain - v0.0.1 - 2013-08-05
* http://training.munich-rugbears.de/shiny/
* Copyright (c) 2013 h0ru5; Licensed MIT */
!function(a){function b(){var b=c(this);return isNaN(b.datetime)||a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return b instanceof Date?d(b):"string"==typeof b?d(a.timeago.parse(b)):"number"==typeof b?d(new Date(b)):d(a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow);var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=void 0===d.wordSeparator?" ":d.wordSeparator;return a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(c)},datetime:function(b){var c=f.isTime(b)?a(b).attr("datetime"):a(b).attr("title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}}),a.fn.timeago=function(){var a=this;a.each(b);var c=f.settings;return c.refreshMillis>0&&setInterval(function(){a.each(b)},c.refreshMillis),a},document.createElement("abbr"),document.createElement("time")}(jQuery),jQuery.timeago.settings.strings={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren"},angular.module("ngLocale",[],["$provide",function(a){var b={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{MONTH:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],SHORTMONTH:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],DAY:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],SHORTDAY:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."],AMPMS:["vorm.","nachm."],medium:"dd.MM.yyyy HH:mm:ss","short":"dd.MM.yy HH:mm",fullDate:"EEEE, d. MMMM y",longDate:"d. MMMM y",mediumDate:"dd.MM.yyyy",shortDate:"dd.MM.yy",mediumTime:"HH:mm:ss",shortTime:"HH:mm"},NUMBER_FORMATS:{DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{minInt:1,minFrac:0,macFrac:0,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3,maxFrac:3},{minInt:1,minFrac:2,macFrac:0,posPre:"",posSuf:" ¤",negPre:"-",negSuf:" ¤",gSize:3,lgSize:3,maxFrac:2}],CURRENCY_SYM:"€"},pluralCat:function(a){return 1==a?b.ONE:b.OTHER},id:"de"})}]),angular.module("jqAutoComplete",[]).directive("jqAutoComplete",function(){return{require:"?ngModel",link:function(a,b,c,d){$(b).autocomplete(),c.ngModel&&b.blur(function(){return a.$apply(function(){d.$setViewValue(b.val())})}),a.$watch(c.jqAutoComplete,function(d){var e=d||null;e&&$(b).autocomplete("option","source",a.$eval(c.jqAutoComplete))})}}}),angular.module("jqDialog",[]).directive("jqDialog",function(){return{link:function(a,b,c){options=c.jqDialog.length>0?a.$eval(c.jqDialog):{modal:!0},options.autoOpen=!1,options.close=function(){a.dlgState=!1,a.$$phase||a.$digest()},options.buttons=c.dlgButtons&&c.dlgButtons.length>0?a.$eval(c.dlgButtons):{Cancel:options.close,Save:function(){c.dlgAction?a.$eval(c.dlgAction)():a.submitDlg()}},a.openDlg=function(){b.dialog("open")},a.$watch("dlgState",function(a,c){console.log("dialog status was "+c+" is now "+a),a?b.dialog("open"):b.dialog("close")}),$(b).dialog(options),a.dlgState=!1}}}),angular.module("pdate",[]).filter("pdate",function(){return function(b){return b?(a=b.split(" "),d=a[0].split("-"),t=a[1].split(":"),new Date(d[0],d[1]-1,d[2],t[0],t[1],t[2])):void 0}}),angular.module("timeago",[]).filter("timeago",function(){return function(a){return $.timeago(a)}}),angular.module("jqButton",[]).directive("jqButton",["$compile",function(){return function(a,b,c){butOptions={},c.jqButton.length>0&&(butOptions.icons={primary:"ui-icon-"+c.jqButton}),b.button(butOptions)}}]),angular.module("trainSite",["pdate","timeago","jqDialog","ngCookies","jqAutoComplete","jqButton"]);var TrainCtrl=function(a,b,c,d){function e(){console.log("Adding Comment "+a.curCmt.msg+" from "+a.curCmt.usr),b.post("/res/trainings/"+tid+"/comments",a.curCmt).error(function(a){console.log("Fehler: "+a)}).success(function(b){console.log("OK!"),a.comments.unshift(b)})}function f(){return a.nameKnown()?(myVote=$.grep(a.votes,function(a){return a.name==c.user}),myVote.length>0?(console.dir(myVote[0]),a.curVote=myVote[0],!0):!1):!1}function g(){nocache=Math.random(),b.get("/res/trainings/"+tid+"/votes?nocache="+nocache).success(function(b){a.votes=b,a.voted=f()})}a.nameKnown=function(){return!(""==a.usrname||!a.usrname)},a.revote=function(){console.log("revoting to "+a.curVote.vid),console.log("Usr is |"+a.curVote.name+"| -> empty:"+(""==a.curVote.name||!a.curVote.name)),a.curVote.name&&""!=a.curVote.name?(a.usrname=a.curVote.name,b.post("/res/trainings/"+tid+"/votes",a.curVote).error(function(a){console.log("Fehler: "+a)}).success(function(){console.log("OK!"),g()})):d.alert("Bitte erst Namen eingeben!")},$.ajaxSetup({cache:!1}),a.usrname=c.user||"",a.curVote={tid:tid,name:c.user,vid:0,vote:""},a.curCmt={msg:"",autor:c.user,tid:tid},b.get("/res/votetypes").success(function(b){a.votetypes=b}),b.get("/res/trainings/"+tid+"/comments").success(function(b){a.comments=b}),b.get("/res/trainings/"+tid+"/stats").success(function(b){a.stats=b}),b.get("/res/users").success(function(b){a.unames=b}),b.get("/res/trainings/"+tid+"/details").success(function(b){a.details=b}),g(),a.dlgState=!1,a.submitDlg=function(){e(),a.dlgState=!1}};TrainCtrl.$inject=["$scope","$http","$cookies","$window"];